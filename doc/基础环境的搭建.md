## 源代码获取

LibreOffice 源代码、每日构建版及 bibisect 仓库国内镜像

[https://www.libreofficechina.org/dev-resources-zh-cn/](https://www.libreofficechina.org/dev-resources-zh-cn/)

如何编译 LibreOffice

[https://www.libreofficechina.org/how-to-build-libreoffice-zh-cn/](https://www.libreofficechina.org/how-to-build-libreoffice-zh-cn/)

## 关于“如何编译 LibreOffice”文中的一些问题

#### 对于“[安装编译环境依赖](https://www.libreofficechina.org/how-to-build-libreoffice-zh-cn/#:~:text=%E4%B8%8B%E6%B5%8B%E8%AF%95%E9%80%9A%E8%BF%87%EF%BC%89-,%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83%E4%BE%9D%E8%B5%96,-%24%20sudo%20dnf)”部分

apt对应的命令是

```plain
sudo apt build-dep libreoffice
```

没有添加deb-src可能导致上条命令失败，所以可以用[官方文档](https://wiki.documentfoundation.org/Development/BuildingOnLinux#Debian_and_Ubuntu)中提到的依赖

```plain
sudo apt-get install git build-essential zip ccache junit4 libkrb5-dev nasm graphviz python3 python3-dev qtbase5-dev libkf5coreaddons-dev libkf5i18n-dev libkf5config-dev libkf5windowsystem-dev libkf5kio-dev autoconf libcups2-dev libfontconfig1-dev gperf default-jdk doxygen libxslt1-dev xsltproc libxml2-utils libxrandr-dev libx11-dev bison flex libgtk-3-dev libgstreamer-plugins-base1.0-dev libgstreamer1.0-dev ant ant-optional libnss3-dev libavahi-client-dev
```

#### external_tarballs

如果不在autogen.input或者autogen.sh的参数里定义，那么默认会使用

<lo_root>/external/tarballs目录（tarballs目录在源代码中不存在）

我一般使用如下命令预先下好tarball（注意替换<lo_root>）

```plain
wget -r --level=1 -nd -P <lo_root>/external/tarballs https://go.suokunlong.cn:88/dl/libreoffice/external_tarballs/
```
MARK：目前（06-13）不确定这些tarball能不能在riscv64上直接拿来用
#### 子模块

子模块有三个，dictionaries helpcontent translations，对于实现软件的基本功能来说，是非必要的

[在x86的Manjaro上编译打包LibreOffice](https://github.com/Sakura286/TmpShare/blob/main/20220606-171636-PKGBUILD)，**不包括这三个子模块可以正常打包**，安装后的程序可以正常运行

## 快速建立一个debian riscv环境

本文在debian sid x86上操作，通过net-disk安装，操作时间2022-06-13

### 一、安装工具与依赖

```plain
sudo apt install buildd binfmt-support qemu-user-statics
```
binfmt应该是识别出所要执行的可执行程序的架构，如果不是当前操作系统的话，丢给qemu去处理
### 二、创建并进入risc-v session

```plain
sudo debootstrap --arch=riscv64 --keyring /usr/share/keyrings/debian-ports-archive-keyring.gpg --include=debian-ports-archive-keyring unstable <rv_path> https://deb.debian.org/debian-ports/
sudo chroot <rv_path>
```
注意，上文中的<rv_path>为最后创建的risc-v session所在的目录
MARK：我想使用国内源[http://mirror.iscas.ac.cn/debian-ports](http://mirror.iscas.ac.cn/debian-ports)来加快下载速度，但是我暂时还不会搞keyring那套东西

### 附：在riscv环境中的一些收尾工作

#### **perl报locale错误**

```plain
perl: warning: Please check that your locale settings:
	LANGUAGE = "en_US:en",
	LC_ALL = (unset),
	LANG = "en_US.UTF-8"
    are supported and installed on your system.
perl: warning: Falling back to the standard locale ("C").
```
**解决办法**
在/etc/bash.bash里添加

```plain
export LC_ALL=C
```
然后source一下该文件
#### java错误

```plain
the java command requires a mounted proc fs (/proc)
```
解决办法
参照[https://stackoverflow.com/questions/36608455/error-installing-jdk-the-keytool-command-requires-a-mounted-proc-fs-proc-wi](https://stackoverflow.com/questions/36608455/error-installing-jdk-the-keytool-command-requires-a-mounted-proc-fs-proc-wi)

```plain
umount /proc
mount -t proc proc /proc
```
 原因MARK
可能的参考资料[https://github.com/debian-pi/raspbian-ua-netinst/issues/314](https://github.com/debian-pi/raspbian-ua-netinst/issues/314)

#### 普通用户使用sudo报错

```plain
susdo: unable to allocate pty No such device
```
**解决办法**
参照[https://serverfault.com/questions/905093/server-refused-to-allocate-pty-how-to-mount-devpts-automatically](https://serverfault.com/questions/905093/server-refused-to-allocate-pty-how-to-mount-devpts-automatically#:~:text=given%20every%20reboot%3A-,mount%20devpts%20/dev/pts%20%2Dt%20devpts,-Adding%20an%20fstab)

```plain
mount devpts /dev/pts -t devpts
```
原因MARK
